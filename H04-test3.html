<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonification_Mammographies</title>
    <link rel="stylesheet" href="S04-styleTest3.css">
    <script src="./lib/fabric.js"></script>
</head>
<body>
    <script type="module">
        
if (typeof (WebAssembly) === "undefined") { //Alerta que aparece en el navegador si no soporta WebAssembly
    alert("WebAssembly is not supported in this browser, the page will not work !")
}

var mock_dsp = null; //Esta variable es para guardar el nodo de audio DSP (Digitla Signal Procesing)

import { createFaustNode } from "./faust/mockDSP.js";
const audioContext = new (window.AudioContext || window.webkitAudioContext)(); 

window.addEventListener("load", async () => {
    const { faustNode } = await createFaustNode(audioContext, "mock_dsp");
    mock_dsp = faustNode;
    if (!mock_dsp) return;
    await mock_dsp.start();
    mock_dsp.connect(audioContext.destination); //Carga la funcion startmockDSP una vez haya cargado la pagina por completo

    document.getElementById("volumeSlider").addEventListener("input", () => {
        mock_dsp.setParamValue("/mock_dsp/volume", parseFloat(volumeSlider.value));
    });
    document.getElementById("muteCheckBox").addEventListener("change", () => {
        mock_dsp.setParamValue("/mock_dsp/mute", parseFloat(muteCheckBox.checked ? 1 : 0));
    });
});

window.addEventListener('touchstart', function() { //Funcion ante toque en pantalla de IOS
    if (audioContext.state !== "suspended") return; //Si no esta suspendido se acaba
    var buffer = audioContext.createBuffer(1, 1, 22050); //Crea un buffer vacio
    var source = audioContext.createBufferSource(); //Fuente de Buffer
    source.buffer = buffer
    source.connect(audioContext.destination); //Conecta el buffer a la salida
    source.start(); //Lo reproduce
    audioContext.resume().then(() => console.log("Audio resumed")); //Continua con el audio que estaba suspendido
    }, false);

window.addEventListener("mousedown", () => { //Relaciona una funcion al evento de hacer click con el mouse
    if (audioContext.state !== "suspended") return; //Si el audio estaba suspendido
    audioContext.resume().then(() => console.log("Audio resumed")) //Lo retorna
});  

    </script>

<b>Controles</b>
<ul>
    <li>Puedes hacer zoom con la rueda del mouse.</li>
    <li>Puedes moverle en la imagen manteniendo presionada la rueda del mouse. (No está funcionando)</li>
    <li>Alternativamente puedes moverte manteniendo presionada la barra espaciadora y moviendo el mouse.</li>
    <li>Puedes cambiar el tamaño del selector y ajusatr el volumen usando los <i>sliders</i> de abajo.</li>
    <li>Puedes silenciar el sonido usando la <i>checkbox</i> de abajo.</li>
</ul>
<div style="display: flex;">
    <canvas id="rasterCanvas"></canvas>
    <div id="arrayDisplay"></div>
    <script src="J00-canvas_old.js"></script>
</div>
<div style="padding-top: 25px;">
    Tamaño del puntero: 
    <input type="range" id="mySlider" min="0" max="200" step="10" value="100" oninput="updateSliderValue(this.value)">
    <span id="sliderValue">100</span>
     | Volumen: 
    <input type="range" id="volumeSlider" min="1" max="10" step="0.01" value="2" oninput="updateVolumeValue(this.value)">
    <span id="volumeValue">2</span>
     | Mute:
    <input type="checkbox" id="muteCheckBox" onchange="updateMuteValue()"/>
    <span id="muteValue">OFF</span>
</div>
    <script src="J01-sonification_old.js"></script>
</body>
</html>