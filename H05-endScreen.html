<!DOCTYPE html>
<html>
<head>
    <title>End Screen</title>
    <link rel="stylesheet" href="S05-styleEndScreen.css">
</head>
<body>
    <div id="centralBlock" class="contenido">
        <h1 id="mainText">Test Finalizado</h1>
        <h2 id="message">Tus respuestas se han guardado.</h2>
        <div style="padding-top: 15px;">
            <button class="nextButton" id="nextButton">Continuar</button>
            <button class="back-button" id="backButton">Cambiar de Usuario</button>
        </div>
    </div>
    <script src="J02-answers.js"></script>
    <script>
        let isMuted = JSON.parse(sessionStorage.getItem('isMuted'));
        let index = isMuted ? [1, 2, 3] : [4, 5, 6];
        var userAnswers = JSON.parse(sessionStorage.getItem('userAnswers'));
        var nombreArchivo = "default";

        document.getElementById('nextButton').addEventListener('click', function() {
            window.location.href = 'H01-testSelection.html';
        });
        document.getElementById('backButton').addEventListener('click', function() {
            window.location.href = 'H00-startScreen.html';
        });
        
        let contenido = `Usuario;${userAnswers[0]}\n`;
        if (userAnswers[index[0]].length == 45 && userAnswers[index[1]].length == 0 && userAnswers[index[2]].length == 0) {
            contenido += '\ntest 1\nimagen;tiempo;nivel de seguridad;respuesta\n';
            for (let answer of userAnswers[index[0]]) {
                contenido += `${answer[0]};${answer[1]};${answer[2]};${answer[3]}\n`;
            }
            nombreArchivo = `${userAnswers[0]}-${isMuted ? 'Mute' : 'Son'}Test1-Answers.csv`; 
        }
        else if (userAnswers[index[0]].length == 45 && userAnswers[index[1]].length == 45 && userAnswers[index[2]].length == 0) {
            contenido += '\ntest 2\nimagen;tiempo;nivel de seguridad;cuadrados\n';
            for (let answer of userAnswers[index[1]]) {
                contenido += `${answer[0]};${answer[1]};${answer[2]};${answer[3]}\n`;
            }
            nombreArchivo = `${userAnswers[0]}-${isMuted ? 'Mute' : 'Son'}Test2-Answers.csv`;  
        }
        else if (userAnswers[index[0]].length == 45 && userAnswers[index[1]].length == 45 && userAnswers[index[2]].length == 2) {
            contenido += '\ntest 3\nimagen;tiempo;nivel de seguridad;cuadrados\n';
            for (let answer of userAnswers[index[2]]) {
                contenido += `${answer[0]};${answer[1]};${answer[2]};${answer[3]}\n`;
            }
            nombreArchivo = `${userAnswers[0]}-${isMuted ? 'Mute' : 'Son'}Test3-Answers.csv`; 
            document.getElementById("mainText").innerText = "Todos los tests finalizados";
            document.getElementById("message").innerText = "Muchas gracias por tu participaci√≥n.";
            document.getElementById("nextButton").disabled = true;
        } 
        else {
            contenido += 'Error';
        }

        const blob = new Blob([contenido], { type: 'text/csv' });
        subirArchivoDesdeBlob(blob, nombreArchivo)
        
    </script>
</body>
</html>