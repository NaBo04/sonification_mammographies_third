<!DOCTYPE html>
<html>
<head>
    <title>End Screen</title>
    <link rel="stylesheet" href="S05-styleEndScreen.css">
</head>
<body>
    <div id="centralBlock" class="contenido">
        <h1 id="mainText">Test Finalizado</h1>
        <h2 id="message">Tus respuestas se han guardado.</h2>
        <div style="padding-top: 15px;">
            <button class="nextButton" id="nextButton">Continuar</button>
            <button class="back-button" id="backButton">Cambiar de Usuario</button>
        </div>
    </div>
    <script src="J02-answers.js"></script>
    <script>
        let isMuted = JSON.parse(sessionStorage.getItem('isMuted'));
        let withContrast = JSON.parse(sessionStorage.getItem('withContrast'));
        let index = (isMuted && !withContrast) ? [1, 2] : isMuted ? [3, 4] : !withContrast ? [5, 6] : [7, 8]; //Para que listas se usaran segun si es el test muteado o no
        var userAnswers = JSON.parse(sessionStorage.getItem('userAnswers'));
        var nombreArchivo = "default";

        document.getElementById('nextButton').addEventListener('click', function() {
            window.location.href = 'H01-testSelection.html';
        });
        document.getElementById('backButton').addEventListener('click', function() {
            window.location.href = 'index.html';
        });
        
        let contenido = `Usuario;${userAnswers[0]}\n`;
        if (userAnswers[index[0]].length == 15 && userAnswers[index[1]].length == 0) {
            contenido += '\ntest 1\nimagen;tiempo;nivel de seguridad;respuesta\n';
            for (let answer of userAnswers[index[0]]) {
                contenido += `${answer[0]};${answer[1]};${answer[2]};${answer[3]}\n`;
            }
            nombreArchivo = `${userAnswers[0]}-${isMuted ? 'Mute' : 'Son'}-${withContrast ? 'Contrast' : 'Static'}-Test1-Answers.csv`; 
        }
        else if (userAnswers[index[0]].length == 15 && userAnswers[index[1]].length == 15) {
            contenido += '\ntest 2\nimagen;tiempo;nivel de seguridad;cuadrados\n';
            for (let answer of userAnswers[index[1]]) {
                contenido += `${answer[0]};${answer[1]};${answer[2]};${answer[3]}\n`;
            }
            nombreArchivo = `${userAnswers[0]}-${isMuted ? 'Mute' : 'Son'}-${withContrast ? 'Contrast' : 'Static'}-Test2-Answers.csv`;  
            document.getElementById("mainText").innerText = "Todos los tests finalizados";
            document.getElementById("message").innerText = "Muchas gracias por tu participaci√≥n.";
            document.getElementById("nextButton").disabled = true;
        }
        else {
            contenido += 'Error';
        }

        const blob = new Blob([contenido], { type: 'text/csv' });
        subirArchivoDesdeBlob(blob, nombreArchivo)
        
    </script>
</body>
</html>