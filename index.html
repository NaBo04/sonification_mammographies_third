<!DOCTYPE html>
<html>
<head>
    <title>Start Screen</title>
    <link rel="stylesheet" href="S00-styleStartScreen.css">
</head>
<body>
    <div id="centralBlock" class="contenido">
        <h1>Tests de sonificación</h1>
        <p>Elige como deseas realizar el test:</p>
        <div style="display: flex;">
            <label style="width: 10vw;"><input type="radio" name="opcion" value="mute"> Sin sonificación.</label>
            <label style="padding-left: 30px;"><input type="radio" name="opcion" value="sonification"> Con sonificación.</label>
        </div>
        <div style="padding-top: 2vh; display: flex">
            <label style="width: 10vw;"><input type="radio" name="opcion2" value="static"> Sin contraste.</label>
            <label style="padding-left: 30px;"><input type="radio" name="opcion2" value="contrast"> Con contraste.</label>
        </div>
        <p>Ingresa tu nombre en formato: Apellido Nombre</p>
        <input type="text" id="userName" placeholder="Ingresa tu nombre">
        <button id="startButton">Comenzar</button>
    </div>

    <script>
        let usersList = localStorage.getItem('usersList'); //Busca la lista de usuarios y sus respuestas de otras iteraciones
        if (usersList == null) {
            usersList = []; //Si no encuentra nada parte como una lista vacia
        } else {
            usersList = JSON.parse(usersList); //Si la encuentra la carga
        }

        document.getElementById('startButton').addEventListener('click', function() {
            var userName = document.getElementById('userName').value; 
            if(userName.trim() === '') { //Por si no colocó nombre
                alert('Por favor, ingresa un nombre de usuario.');
                return;
            }

            const seleccionada1 = document.querySelector('input[name="opcion"]:checked'); //Manejo de seleccion de opcion con/sin sonificacion
            if (seleccionada1) {
                var isMuted = false;
                if (seleccionada1.value == "mute"){
                    isMuted = true;
                }  
            } else { //Alerta por si no escogio el test con o sin sonificacion
                alert("Por favor, selecciona una opción de sonificación para el test.");
                return;
            }
            const seleccionada2 = document.querySelector('input[name="opcion2"]:checked'); //Manejo de seleccion de opcion con/sin contraste
            if (seleccionada2) {
                var withContrast = false;
                if (seleccionada2.value == "contrast"){
                    withContrast = true;
                }  
            } else { //Alerta por si no escogio el test con o sin contraste
                alert("Por favor, selecciona una opción de contraste para el test.");
                return;
            }

            let userAnswers = null; //Variable para las respuestas del usuario
            if (usersList.length != 0) { //Si ya hay respuestas anteriores
                for (let val_name of usersList) { //Revisa en cada una de ellas
                    if (val_name[0] == userName) { //Si ya hay para el mismo nombre de usuario
                        userAnswers = val_name; //Entonces carga esas respuestas
                    }
                }
            }
            if ( userAnswers == null ) { //Si no encontro respuestas previas
                userAnswers = [userName, [], [], [], [], [], [], [], []]; //Crea las respuestas del usuario como [nombre, [test1_mute_static], [test2_MS], [1M_contrast], [2MC], [1_son_S], [2SS], [1SC], [2SC]]
                usersList.push(userAnswers); //Lo agrega a la lista de respuestas de usuarios
                localStorage.setItem('usersList', JSON.stringify(usersList)); //Lo guarda en la memoria del navegador
            }
            
            sessionStorage.setItem('userAnswers', JSON.stringify(userAnswers)); //Guarda las respuestas de este usuario en la memoria de sesion
            sessionStorage.setItem("isMuted", JSON.stringify(isMuted)); //Guarda tambien el tipo de test, mute o son
            sessionStorage.setItem("withContrast", JSON.stringify(withContrast)); //Guarda tambien el tipo de test, static o contrast
            window.location.href = 'H01-testSelection.html';
        });
    </script>
</body>
</html>