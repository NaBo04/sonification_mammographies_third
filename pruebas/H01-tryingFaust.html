<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prueba de Faust</title>
  <style>
    .slider-container {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Control de parámetros</h1>

  <div id="sliders">
    <div class="slider-container">
      <label for="mute">Mute</label>
      <input type="checkbox" id="mute" />
    </div>
    <div class="slider-container">
      <label for="mean">Mean</label>
      <input type="range" id="mean" min="0" max="0.1" step="0.001" value="0.05">
    </div>
    <div class="slider-container">
      <label for="std_dev">Standar Deviation</label>
      <input type="range" id="std_dev" min="0" max="0.1" step="0.001" value="0.05">
    </div>
    <div class="slider-container">
      <label for="skewness">Skewness</label>
      <input type="range" id="skewness" min="0" max="0.1" step="0.001" value="0.05">
    </div>
    <div class="slider-container">
      <label for="kurtosis">Kurtosis</label>
      <input type="range" id="kurtosis" min="0" max="0.1" step="0.001" value="0.05">
    </div>
    <div class="slider-container">
      <label for="volume">Volume</label>
      <input type="range" id="volume" min="1" max="10" step="0.01" value="2">
    </div>
  </div>

  <script type="module">
    import { createFaustNode } from "./faust/mockDSP.js";
  
    window.addEventListener("load", async () => {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  
      const { faustNode: dsp } = await createFaustNode(audioContext, "mock_dsp");
      if (!dsp) return;
  
      await dsp.start();
      dsp.connect(audioContext.destination);
    
      // Mute (checkbox)
      const muteCheckbox = document.getElementById("mute");
      muteCheckbox.addEventListener("change", () => {
        dsp.setParamValue("/mock_dsp/mute", muteCheckbox.checked ? 1 : 0);
      });
      // Conectar sliders con parámetros del DSP
      const paramMap = {
        mean: "/mock_dsp/mean",
        std_dev: "/mock_dsp/std_dev",
        skewness: "/mock_dsp/skewness",
        kurtosis: "/mock_dsp/kurtosis",
        volume: "/mock_dsp/volume",
      };
      for (const [id, address] of Object.entries(paramMap)) {
        const slider = document.getElementById(id);
        slider.addEventListener("input", () => {
          dsp.setParamValue(address, parseFloat(slider.value));
        });
      }
    });
  </script>
</body>
</html>